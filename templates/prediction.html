<!-- templates/prediction.html -->
<!-- 版本: 1.0.0 -->
{% extends "base.html" %}
{% from "components/lottery_balls.html" import display_balls %}

{% block title %}号码预测{% endblock %}

{% block head %}
<style>
    .ball-container {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-bottom: 10px;
    }
    .rule-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #eee;
        padding: 10px;
        border-radius: 5px;
        background-color: #f9f9f9;
    }
    .prediction-result-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        background-color: #fff;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .prediction-result-card .card-title {
        font-size: 1.1em;
        margin-bottom: 10px;
    }
    .prediction-result-card .ball-container {
        margin-bottom: 5px;
    }
</style>
{% endblock %}

{% block content %}
<h1 class="mb-4">号码预测</h1>

<div class="alert alert-info text-center" role="alert">
    本页面提供的号码预测仅供娱乐参考，不构成任何投注建议。
</div>

<div class="mb-3">
    <a href="#" class="btn btn-danger active me-2" id="ssq_prediction_tab">双色球预测</a>
    <a href="#" class="btn btn-primary" id="dlt_prediction_tab">大乐透预测</a>
</div>

<div id="ssq_prediction_section" class="lottery-section">
    <h2 class="mb-3">双色球预测</h2>

    <!-- 最新开奖号码 -->
    <div class="card mb-4">
        <div class="card-header">最新 {{ settings.prediction_latest_draws }} 期开奖号码</div>
        <div class="card-body">
            {% if latest_ssq_draws %}
                {% for draw in latest_ssq_draws %}
                <p class="mb-1">
                    <strong>第 {{ draw.issue }} 期 ({{ draw.draw_date.strftime('%Y-%m-%d') }}):</strong>
                    红球: {{ display_balls(draw.get_red_balls_list(), 'red') }}
                    蓝球: {{ display_balls(draw.get_blue_balls_list(), 'blue') }}
                </p>
                {% endfor %}
            {% else %}
                <p>暂无最新双色球开奖数据。</p>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <!-- 预测规则文字 -->
            <div class="card mb-4">
                <div class="card-header">双色球预测规则</div>
                <div class="card-body rule-list">
                    <p><strong>4.1.1 蓝球规则:</strong> 蓝球如最新一期开出过的号码就不作为本期的预测候选号码。蓝球连续{{ settings.ssq_blue_consecutive_3_prob }}期开出此号码则此号码候选池内的出现的概率为{{ settings.ssq_blue_consecutive_3_prob * 100 }}%，如果连续{{ settings.ssq_blue_consecutive_5_prob }}期开出同样的蓝球号码，则此号码候选池内的出现的概率为{{ settings.ssq_blue_consecutive_5_prob * 100 }}%。</p>
                    <p><strong>4.1.2 红球遗漏权重:</strong> 红球最近未开出号码连续遗漏次数的第1多的号码数字作为候选球池中的一员，权重占 {{ settings.ssq_red_omit_1_weight * 100 }}%，第2多占{{ settings.ssq_red_omit_2_weight * 100 }}%，第3多占{{ settings.ssq_red_omit_3_weight * 100 }}%，第4多占{{ settings.ssq_red_omit_4_weight * 100 }}%，第5多占{{ settings.ssq_red_omit_5_weight * 100 }}%，第6多占{{ settings.ssq_red_omit_6_weight * 100 }}%。其他所有号码数字占比加起来平分剩下的百分比。</p>
                    <p><strong>4.1.3 红球重复概率:</strong> 如果红球最新开奖号码中的某一个号码连续开出重复3期及以上，则这个号码在候选号码池中的概率增加到{{ settings.ssq_red_consecutive_3_prob * 100 }}%，第二个重复3期以上的号码，概率增加到{{ settings.ssq_red_consecutive_3_second_prob * 100 }}%，其他号码概率平分剩下的百分比。</p>
                    <p><strong>4.1.4 红球区域分布:</strong> 将数字区间[1-8]、[9-16]、[17-24]、[25-33]作为4个区域，候选红球的数字区域分布大于等于 {{ settings.ssq_red_area_min_count }}个数字区间。</p>
                    <p><strong>4.1.5 红球重复限制:</strong> 红球预测的号码中的数字与前2期的开奖结果重复的号码加起来不超过{{ settings.ssq_red_prev_2_draws_max_repeat }}个。</p>
                    <p><strong>4.1.6 红球连号限制:</strong> 红球球不出现连续{{ settings.ssq_red_max_consecutive_balls + 1 }}个及以上数字的号码。</p>
                    <p><strong>4.1.10 红球遗漏降权:</strong> 红球若遗漏超过{{ settings.ssq_red_omit_12_prob }}期，则该号码在整个组合中出现的概率降至{{ settings.ssq_red_omit_12_prob * 100 }}%，红球若遗漏超过{{ settings.ssq_red_omit_13_prob }}期，则该号码在整个组合中出现的概率降至{{ settings.ssq_red_omit_13_prob * 100 }}%，红球若遗漏超过{{ settings.ssq_red_omit_14_prob }}期，则该号码在整个组合中出现的概率降至{{ settings.ssq_red_omit_14_prob * 100 }}%。</p>
                    <p><strong>4.5 规则冲突优先级:</strong> 所有规则如果产生冲突，则按照顺序作为优先级，在先的优先考虑，舍弃后一条规则。</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <!-- 遗漏期数最多的号码 -->
            <div class="card mb-4">
                <div class="card-header">遗漏期数最多的号码</div>
                <div class="card-body">
                    <p><strong>红球 (遗漏最多的 {{ settings.prediction_omitted_red_balls }} 个):</strong></p>
                    <div class="ball-container" id="ssq_omitted_red_balls">
                        <!-- JS动态加载 -->
                    </div>
                    <p><strong>蓝球 (遗漏最多的 {{ settings.prediction_omitted_blue_balls }} 个):</strong></p>
                    <div class="ball-container" id="ssq_omitted_blue_balls">
                        <!-- JS动态加载 -->
                    </div>
                </div>
            </div>
            <!-- 组合数及筛选饼状图 -->
            <div class="card mb-4">
                <div class="card-header">组合筛选概览</div>
                <div class="card-body">
                    <p>总组合数: <span id="ssq_total_combinations">计算中...</span></p>
                    <p>通过规则筛选掉的可能: <span id="ssq_filtered_combinations">计算中...</span></p>
                    <p>中奖的可能性: <span id="ssq_winning_chance">计算中...</span></p>
                    <p>节省费用: <span id="ssq_saved_cost">计算中...</span> 元</p>
                    <canvas id="ssq_filter_chart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 生成号码区域 -->
    <div class="card mb-4">
        <div class="card-header">生成预测号码</div>
        <div class="card-body">
            <div class="mb-3 row align-items-center">
                <label for="ssq_num_generate" class="col-sm-3 col-form-label">生成号码组数:</label>
                <div class="col-sm-3">
                    <input type="number" class="form-control" id="ssq_num_generate" value="{{ settings.prediction_generated_count }}" min="1" max="50">
                </div>
                <div class="col-sm-6">
                    <button class="btn btn-success me-2" id="generate_ssq_prediction">生成预测号码</button>
                    <button class="btn btn-info" id="generate_ssq_random">生成真随机号码</button>
                </div>
            </div>

            <hr>

            <h5>预测号码 (单式)</h5>
            <div id="ssq_predicted_numbers_output">
                <!-- 预测号码将在此处动态生成 -->
                <p class="text-muted">点击“生成预测号码”按钮。</p>
            </div>

            <h5 class="mt-4">真随机号码</h5>
            <div id="ssq_random_numbers_output">
                <!-- 随机号码将在此处动态生成 -->
                <p class="text-muted">点击“生成真随机号码”按钮。</p>
            </div>

            <hr>

            <!-- 复式预测功能 (4.3) -->
            <h5 class="mt-4">双色球复式预测 (4.3)</h5>
            <div class="mb-3 row align-items-center">
                <label for="ssq_complex_red_count" class="col-sm-3 col-form-label">红球数量 (7-20):</label>
                <div class="col-sm-2">
                    <input type="number" class="form-control" id="ssq_complex_red_count" value="7" min="7" max="20">
                </div>
                <label for="ssq_complex_blue_count" class="col-sm-3 col-form-label">蓝球数量 (1-16):</label>
                <div class="col-sm-2">
                    <input type="number" class="form-control" id="ssq_complex_blue_count" value="1" min="1" max="16">
                </div>
                <div class="col-sm-2">
                    <button class="btn btn-warning" id="generate_ssq_complex_prediction">生成复式号码</button>
                </div>
            </div>
            <div id="ssq_complex_prediction_output">
                <p class="text-muted">复式号码将在此处生成。</p>
            </div>
        </div>
    </div>
</div>

<div id="dlt_prediction_section" class="lottery-section" style="display: none;">
    <h2 class="mb-3">大乐透预测</h2>

    <!-- 最新开奖号码 -->
    <div class="card mb-4">
        <div class="card-header">最新 {{ settings.prediction_latest_draws }} 期开奖号码</div>
        <div class="card-body">
            {% if latest_dlt_draws %}
                {% for draw in latest_dlt_draws %}
                <p class="mb-1">
                    <strong>第 {{ draw.issue }} 期 ({{ draw.draw_date.strftime('%Y-%m-%d') }}):</strong>
                    红球: {{ display_balls(draw.get_red_balls_list(), 'red') }}
                    蓝球: {{ display_balls(draw.get_blue_balls_list(), 'blue') }}
                </p>
                {% endfor %}
            {% else %}
                <p>暂无最新大乐透开奖数据。</p>
            {% endif %}
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <!-- 预测规则文字 -->
            <div class="card mb-4">
                <div class="card-header">大乐透预测规则</div>
                <div class="card-body rule-list">
                    <p><strong>4.2.1 蓝球规则:</strong> 如果与最新一期的蓝球重复，则重复的每个号码数字在候选池中的出现概率不超过{{ settings.dlt_blue_repeat_prob * 100 }}%。如果任何一个蓝球号码连续5期开出，则此号码候选池内的出现的概率为{{ settings.dlt_blue_consecutive_5_prob * 100 }}%。</p>
                    <p><strong>4.2.2 红球遗漏权重:</strong> 红球最近未开出号码连续遗漏次数的第1多的号码数字作为候选球池中的一员，权重占 {{ settings.dlt_red_omit_1_weight * 100 }}%，第2多占{{ settings.dlt_red_omit_2_weight * 100 }}%，第3多占{{ settings.dlt_red_omit_3_weight * 100 }}%，第4多占{{ settings.dlt_red_omit_4_weight * 100 }}%，第5多占{{ settings.dlt_red_omit_5_weight * 100 }}%。其他所有号码数字占比加起来平分剩下的百分比。</p>
                    <p><strong>4.2.3 红球重复概率:</strong> 如果红球最新开奖号码中的某一个号码连续开出重复3期及以上，则这个号码在候选号码池中的概率增加到{{ settings.dlt_red_consecutive_3_prob * 100 }}%，其他号码概率平分剩下的百分比。</p>
                    <p><strong>4.2.4 红球区域分布:</strong> 将数字区间[1-8]、[9-16]、[17-24]、[25-35]作为4个区域，候选红球的数字区域分布大于等于 {{ settings.dlt_red_area_min_count }}个数字区间。</p>
                    <p><strong>4.2.5 红球重复限制:</strong> 红球预测的号码中的数字与前2期的开奖结果重复的号码加起来不超过{{ settings.dlt_red_prev_2_draws_max_repeat }}个。</p>
                    <p><strong>4.2.6 红球连号限制:</strong> 红球球不出现连续{{ settings.dlt_red_max_consecutive_balls + 1 }}个及以上数字的号码。</p>
                    <p><strong>4.2.10 红球遗漏降权:</strong> 红球若遗漏超过{{ settings.dlt_red_omit_12_prob }}期，则该号码在整个组合中出现的概率降至{{ settings.dlt_red_omit_12_prob * 100 }}%，红球若遗漏超过{{ settings.dlt_red_omit_13_prob }}期，则该号码在整个组合中出现的概率降至{{ settings.dlt_red_omit_13_prob * 100 }}%，红球若遗漏超过{{ settings.dlt_red_omit_14_prob }}期，则该号码在整个组合中出现的概率降至{{ settings.dlt_red_omit_14_prob * 100 }}%。</p>
                    <p><strong>4.5 规则冲突优先级:</strong> 所有规则如果产生冲突，则按照顺序作为优先级，在先的优先考虑，舍弃后一条规则。</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <!-- 遗漏期数最多的号码 -->
            <div class="card mb-4">
                <div class="card-header">遗漏期数最多的号码</div>
                <div class="card-body">
                    <p><strong>红球 (遗漏最多的 {{ settings.prediction_omitted_red_balls }} 个):</strong></p>
                    <div class="ball-container" id="dlt_omitted_red_balls">
                        <!-- JS动态加载 -->
                    </div>
                    <p><strong>蓝球 (遗漏最多的 {{ settings.prediction_omitted_blue_balls }} 个):</strong></p>
                    <div class="ball-container" id="dlt_omitted_blue_balls">
                        <!-- JS动态加载 -->
                    </div>
                </div>
            </div>
            <!-- 组合数及筛选饼状图 -->
            <div class="card mb-4">
                <div class="card-header">组合筛选概览</div>
                <div class="card-body">
                    <p>总组合数: <span id="dlt_total_combinations">计算中...</span></p>
                    <p>通过规则筛选掉的可能: <span id="dlt_filtered_combinations">计算中...</span></p>
                    <p>中奖的可能性: <span id="dlt_winning_chance">计算中...</span></p>
                    <p>节省费用: <span id="dlt_saved_cost">计算中...</span> 元</p>
                    <canvas id="dlt_filter_chart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- 生成号码区域 -->
    <div class="card mb-4">
        <div class="card-header">生成预测号码</div>
        <div class="card-body">
            <div class="mb-3 row align-items-center">
                <label for="dlt_num_generate" class="col-sm-3 col-form-label">生成号码组数:</label>
                <div class="col-sm-3">
                    <input type="number" class="form-control" id="dlt_num_generate" value="{{ settings.prediction_generated_count }}" min="1" max="50">
                </div>
                <div class="col-sm-6">
                    <button class="btn btn-success me-2" id="generate_dlt_prediction">生成预测号码</button>
                    <button class="btn btn-info" id="generate_dlt_random">生成真随机号码</button>
                </div>
            </div>

            <hr>

            <h5>预测号码 (单式)</h5>
            <div id="dlt_predicted_numbers_output">
                <!-- 预测号码将在此处动态生成 -->
                <p class="text-muted">点击“生成预测号码”按钮。</p>
            </div>

            <h5 class="mt-4">真随机号码</h5>
            <div id="dlt_random_numbers_output">
                <!-- 随机号码将在此处动态生成 -->
                <p class="text-muted">点击“生成真随机号码”按钮。</p>
            </div>

            <hr>

            <!-- 复式预测功能 (4.4) -->
            <h5 class="mt-4">大乐透复式预测 (4.4)</h5>
            <div class="mb-3 row align-items-center">
                <label for="dlt_complex_red_count" class="col-sm-3 col-form-label">红球数量 (6-35):</label>
                <div class="col-sm-2">
                    <input type="number" class="form-control" id="dlt_complex_red_count" value="6" min="6" max="35">
                </div>
                <label for="dlt_complex_blue_count" class="col-sm-3 col-form-label">蓝球数量 (1-12):</label>
                <div class="col-sm-2">
                    <input type="number" class="form-control" id="dlt_complex_blue_count" value="2" min="1" max="12">
                </div>
                <div class="col-sm-2">
                    <button class="btn btn-warning" id="generate_dlt_complex_prediction">生成复式号码</button>
                </div>
            </div>
            <div id="dlt_complex_prediction_output">
                <p class="text-muted">复式号码将在此处生成。</p>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // JavaScript for tab switching
    document.getElementById('ssq_prediction_tab').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('ssq_prediction_section').style.display = 'block';
        document.getElementById('dlt_prediction_section').style.display = 'none';
        this.classList.add('active');
        document.getElementById('dlt_prediction_tab').classList.remove('active');
    });

    document.getElementById('dlt_prediction_tab').addEventListener('click', function(e) {
        e.preventDefault();
        document.getElementById('dlt_prediction_section').style.display = 'block';
        document.getElementById('ssq_prediction_section').style.display = 'none';
        this.classList.add('active');
        document.getElementById('ssq_prediction_tab').classList.remove('active');
    });

    // Function to render lottery balls (replicated from Jinja macro for JS use)
    function renderBalls(balls, ballType, isConsecutiveCheck = true) {
        let html = '';
        const sortedBalls = [...balls].sort((a, b) => a - b);
        for (let i = 0; i < sortedBalls.length; i++) {
            const ball = sortedBalls[i];
            let isConsecutive = false;
            if (isConsecutiveCheck) {
                if (i > 0 && sortedBalls[i-1] === ball - 1) {
                    isConsecutive = true;
                } else if (i < sortedBalls.length - 1 && sortedBalls[i+1] === ball + 1) {
                    isConsecutive = true;
                }
            }
            html += `<span class="lottery-ball ball-${ballType} ${isConsecutive ? 'ball-consecutive' : ''}">${String(ball).padStart(2, '0')}</span>`;
        }
        return html;
    }

    // Function to fetch and display omitted balls
    async function fetchAndDisplayOmittedBalls(lotteryType) {
        try {
            const response = await fetch(`/api/omitted_balls?lottery_type=${lotteryType}`);
            const data = await response.json();

            const redOutput = document.getElementById(`${lotteryType}_omitted_red_balls`);
            const blueOutput = document.getElementById(`${lotteryType}_omitted_blue_balls`);

            redOutput.innerHTML = '';
            data.red_omitted.forEach(item => {
                redOutput.innerHTML += renderBalls([item.ball], 'red', false) + ` (${item.omission_count}期)`;
            });

            blueOutput.innerHTML = '';
            data.blue_omitted.forEach(item => {
                blueOutput.innerHTML += renderBalls([item.ball], 'blue', false) + ` (${item.omission_count}期)`;
            });

        } catch (error) {
            console.error('Error fetching omitted balls:', error);
            document.getElementById(`${lotteryType}_omitted_red_balls`).innerHTML = '<p class="text-danger">加载失败。</p>';
            document.getElementById(`${lotteryType}_omitted_blue_balls`).innerHTML = '<p class="text-danger">加载失败。</p>';
        }
    }

    // Function to fetch and display prediction results
    async function fetchAndDisplayPredictions(lotteryType, numGenerate, isRandom = false, isComplex = false, redCount = null, blueCount = null) {
        const outputDivId = isRandom ? `${lotteryType}_random_numbers_output` : (isComplex ? `${lotteryType}_complex_prediction_output` : `${lotteryType}_predicted_numbers_output`);
        const outputDiv = document.getElementById(outputDivId);
        outputDiv.innerHTML = '<p class="text-muted">生成中...</p>';

        let url = `/api/generate_prediction?lottery_type=${lotteryType}&count=${numGenerate}&is_random=${isRandom}`;
        if (isComplex) {
            url += `&is_complex=true&red_count=${redCount}&blue_count=${blueCount}`;
        }

        try {
            const response = await fetch(url);
            const data = await response.json();

            if (data.error) {
                outputDiv.innerHTML = `<p class="text-danger">生成失败: ${data.error}</p>`;
                return;
            }

            outputDiv.innerHTML = '';
            data.predictions.forEach(prediction => {
                let cost = prediction.cost ? ` (费用: ${prediction.cost}元)` : '';
                outputDiv.innerHTML += `
                    <div class="prediction-result-card">
                        <p class="card-title">号码组合${cost}:</p>
                        <div class="ball-container">
                            红球: ${renderBalls(prediction.red_balls, 'red')}
                            蓝球: ${renderBalls(prediction.blue_balls, 'blue')}
                        </div>
                        <div class="mt-2">
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="regenerateNumber('${lotteryType}', ${isRandom}, ${isComplex}, ${redCount}, ${blueCount}, this)">重新生成</button>
                            <button class="btn btn-sm btn-outline-info" onclick="checkHistoryMatch('${lotteryType}', '${prediction.red_balls.join(',')}', '${prediction.blue_balls.join(',')}', this)">核对历史中奖</button>
                            ${isRandom ? `<button class="btn btn-sm btn-outline-warning ms-2" onclick="checkRandomRules('${lotteryType}', '${prediction.red_balls.join(',')}', '${prediction.blue_balls.join(',')}', this)">核对规则</button>` : ''}
                        </div>
                        <div class="mt-2 small text-muted" id="result_for_${lotteryType}_${prediction.red_balls.join('')}${prediction.blue_balls.join('')}"></div>
                    </div>
                `;
            });
        } catch (error) {
            console.error('Error fetching predictions:', error);
            outputDiv.innerHTML = '<p class="text-danger">生成号码失败。</p>';
        }
    }

    // Placeholder functions for button actions
    function regenerateNumber(lotteryType, isRandom, isComplex, redCount, blueCount, button) {
        const numGenerate = button.closest('.card-body').querySelector('input[type="number"]').value;
        fetchAndDisplayPredictions(lotteryType, numGenerate, isRandom, isComplex, redCount, blueCount);
    }

    async function checkHistoryMatch(lotteryType, redBallsStr, blueBallsStr, button) {
        const resultDiv = button.closest('.prediction-result-card').querySelector('.mt-2.small.text-muted');
        resultDiv.innerHTML = '核对中...';
        try {
            const response = await fetch(`/api/check_history_match?lottery_type=${lotteryType}&red_balls=${redBallsStr}&blue_balls=${blueBallsStr}`);
            const data = await response.json();
            if (data.error) {
                resultDiv.innerHTML = `<span class="text-danger">${data.error}</span>`;
            } else if (data.matches.length > 0) {
                let html = '历史中奖记录:<br>';
                data.matches.forEach(match => {
                    html += `第 ${match.issue} 期: ${match.prize_level} (${match.prize_amount}元)<br>`;
                });
                resultDiv.innerHTML = html;
            } else {
                resultDiv.innerHTML = '未在历史开奖中找到中奖记录。';
            }
        } catch (error) {
            console.error('Error checking history match:', error);
            resultDiv.innerHTML = '<span class="text-danger">核对失败。</span>';
        }
    }

    async function checkRandomRules(lotteryType, redBallsStr, blueBallsStr, button) {
        const resultDiv = button.closest('.prediction-result-card').querySelector('.mt-2.small.text-muted');
        resultDiv.innerHTML = '核对规则中...';
        try {
            const response = await fetch(`/api/check_rules?lottery_type=${lotteryType}&red_balls=${redBallsStr}&blue_balls=${blueBallsStr}`);
            const data = await response.json();
            if (data.error) {
                resultDiv.innerHTML = `<span class="text-danger">${data.error}</span>`;
            } else if (data.broken_rules.length > 0) {
                let html = '不符合以下规则:<br>';
                data.broken_rules.forEach(rule => {
                    html += `- ${rule}<br>`;
                });
                resultDiv.innerHTML = html;
            } else {
                resultDiv.innerHTML = '符合所有预测规则。';
            }
        } catch (error) {
            console.error('Error checking rules:', error);
            resultDiv.innerHTML = '<span class="text-danger">规则核对失败。</span>';
        }
    }

    // Event listeners for generation buttons
    document.getElementById('generate_ssq_prediction').addEventListener('click', () => {
        const num = document.getElementById('ssq_num_generate').value;
        fetchAndDisplayPredictions('ssq', num, false);
    });
    document.getElementById('generate_ssq_random').addEventListener('click', () => {
        const num = document.getElementById('ssq_num_generate').value;
        fetchAndDisplayPredictions('ssq', num, true);
    });
    document.getElementById('generate_ssq_complex_prediction').addEventListener('click', () => {
        const redCount = document.getElementById('ssq_complex_red_count').value;
        const blueCount = document.getElementById('ssq_complex_blue_count').value;
        fetchAndDisplayPredictions('ssq', 1, false, true, redCount, blueCount);
    });

    document.getElementById('generate_dlt_prediction').addEventListener('click', () => {
        const num = document.getElementById('dlt_num_generate').value;
        fetchAndDisplayPredictions('dlt', num, false);
    });
    document.getElementById('generate_dlt_random').addEventListener('click', () => {
        const num = document.getElementById('dlt_num_generate').value;
        fetchAndDisplayPredictions('dlt', num, true);
    });
    document.getElementById('generate_dlt_complex_prediction').addEventListener('click', () => {
        const redCount = document.getElementById('dlt_complex_red_count').value;
        const blueCount = document.getElementById('dlt_complex_blue_count').value;
        fetchAndDisplayPredictions('dlt', 1, false, true, redCount, blueCount);
    });


    // Initial load
    document.addEventListener('DOMContentLoaded', function() {
        fetchAndDisplayOmittedBalls('ssq');
        fetchAndDisplayOmittedBalls('dlt');
        // TODO: Fetch and display total combinations and filter chart data
    });
</script>
{% endblock %}
